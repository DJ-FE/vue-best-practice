# vue-best-practice
There are some best practices for vue project in md file
### 引言
何为最佳实践？业务场景不同，适用的技术栈与方案也不同，所以‘最适用的就是最佳的’。本文章只是针对目前团队的开发模式总结一些开发实践，谈不上最佳，但可能却是目前最适用的

### 项目模板
首先需求到来的时候，无非有两种情况，1、新需求   2、迭代需求。无论是新需求还是迭代需求，我们目前项目开发都是结合本地构建（工程化），所以首先要有一个适合我们业务需求的vue模板。目前已有两套vue模板：1.家政的DJ-FE/vue-template 2.架构组统一的vue- common;如果项目是新需求（从零开始），建议使用vue-common，方便后期统一维护；反之，如果需求之前已经是基于家政的vue模板，那应该继续使用该模板，避免升级迁移带来不必要的问题。

家政vue模板地址：[https://github.com/DJ-FE/vue-template](https://github.com/DJ-FE/vue-template)

架构组vue模板地址：[http://git.daojia-inc.com/fe/vue-common](http://git.daojia-inc.com/fe/vue-common)


### 项目配置
#### DJ-FE/vue-template模板
包括：入口文件（多入口）、mock数据、打包路径（如果接入djoy，路径要按规则设定）、静态资源服务器配置、sprite等等

1. 入口文件配置->`index.js`的`pages`项，当我们配置入口时，我们要考虑一个问题‘项目是要做成单页还是多页’，如果是spa的话，那么一个入口就够了，其余的工作交个vue-router；但如果是多页的话，那么每页都要有相应的配置，具体配置见脚手架
2. mock配置->`mock.js`或`./mock`目录，在配置mock数据之前，我们一定要完成与RD商定数据格式的工作，这样一旦数据格式商定下来，即使后期RD侧有稍许的改动，也不会对FE有很大的影响（最好还是不要改）；后期mock数据的配置方式应统一，即：mock目录下一个数据接口是一个js文件，`config/mock.js`只是简单的引入数据接口模块
3. 打包路径->`index.js`的`assetsPublicPath`项，区分测试(test)与线上(prod)
4. 静态资源服务器配置->`deploy.js`，也是区分test和prod
5. 雪碧图，具体使用见后续sprite一节
#### vue-common模板
详情见confluence文档：[http://confluence.daojia-inc.com/pages/viewpage.action?pageId=45948660](http://confluence.daojia-inc.com/pages/viewpage.action?pageId=45948660)

### 最佳实践
tips：以下实践排名不分先后
1. **代码规范**，对于开发阶段，首先最重要的是代码规范，eslint功能一定不要关闭，eslint功能一定不要关闭，eslint功能一定不要关闭，重要的事情说3遍；具体规范见[规范文档](http://confluence.daojia-inc.com/pages/viewpage.action?pageId=50599262)。
2. **项目目录结构**（以DJ-FE/vue-template为例），一般目录结构说的就是src这个目录的结构布局，其大致结构如下：

    1）**assets目录**,用于存放静态图片
    
    2）**base目录**，用于存放基础组件，有prompt、toast等
    
    3）**components目录**，用于存放我们的业务组件，一般是vue单文件组件
    
    4）**utils目录**，存放工具方法，后期会统一，现有两种方案：1.跟随模板，开发时直接以相对地址引入具体模块  2.以包的形式，将依赖写入package.json，最终可能会以此方案落地，原因：减少模板体积，通用
    
    5）**入口文件main.js**，在这个文件中，我们一般会做代码分割，路由设置

3. **组件划分**，关于组件划分，没有明确的规定，但是倾向于‘见组件名称可知组件逻辑，拆分数量不易过多’的原则，具体划分视项目而定

4. **公共样式文件**，对于公共样式，我们已有reset.css（reset.scss）和base.css（reset.scss），如有其他需求，可交由团队中具体一人来更新维护，避免出现多版本及兼容性问题

5. **promise**，如果项目中使用了 promise，那么在入口文件main.js开头处应使用`require('es6-promise').polyfill()`来打补丁，作用就是兼容不支持promise的浏览器;先前vue-resource在一些安卓手机会有promise兼容问题，就是采用该工具来修复的

6. **路由**，路由最好不要都是异步加载的，至少要有一个route是同步方式加载（即在main.js中直接import）；在此前的一个项目中，所有的路由都是采用异步渲染的方式，结果其中一个route的js代码报错后，出现了白屏，所以要至少保证首屏可以渲染

7. **代码分割**，分割多少，如何分割应该基于route，目前大部分项目都是一个route分割成一个文件，如果一个文件过大，也可再次分割

8. **Bus问题**，Bus是为了解决小项目使用Vuex过于繁重而采用的一种轻量的组件通信方案，简单易用，实现原理是event；但是在最近的一个项目中出现‘一次触发，多次回调’的问题，其根本原因是route销毁后，其内的Bus事件并没有被自动移除，所以我们需要在组件的destoryed周期钩子中手动移除每一个Bus事件；其实这也不能算是一个bug，只能算是在使用Bus时的一个疏忽

9. **图片懒加载**，关于懒加载，我们目前使用vue-lazyload，虽然在交互上已经满足了PM的需求，但是用户体验很友好，原因是图片在加载完成之前是空白，加载完成后图片渲染出现闪屏；为解决这一问题，孙培君同学给出了‘模糊图片占位’的解决方案，后期待试点成功后，可作为图片懒加载的最佳实践

10. **基础组件**，基础组件的建设工作现由架构组童鞋负责，部分业务线童鞋参与；目前每个组件单独一个npm包，最新版本均已同步到家npm；若对组件有新的需求，也可向架构组的同学提意见；后期组件达到一定数量，可考虑搭建组件库

11. **vue-resource or axios?**，这两款http请求工具没有很明确的优劣之分，但是vue官方已声明不再维护，也不建议使用vue-resource；而且axios的使用反馈也比较良好，虽说可能也有一些坑点，但目前看axios的维护还是比较放心的，所以建议后期项目可以考虑使用axios（可能目前已经有项目在使用了；vue-common也继承了axios）

12. **版本问题**，目前FE侧对于版本控制是比较弱的，每次上线或修复bug都要让RD更新js的版本号，依赖度大；前期尝试接入Djoy，但在接入过程中发现FE的提测成本过高，没修改一处代码都要进行一系列完整的提测部署过程，效率极低。先有两种方式解决该问题：1.FE在联调和测试阶段不接入Djoy，待项目达到可上线状态时（沙箱阶段）再接入Djoy，毕竟前端的版本控制优势在修复线上问题和代码回滚时才体现出价值（该方案只是本人自己提出的，暂未得到大家认可）；2.向PMO侧提需求，简化流程，降低提测成本，具体方案应由FE于PMO协商而定
